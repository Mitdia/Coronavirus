<!DOCTYPE html>
<html lang="en">
{% macro embed(obj) -%}
<div class="bk-root" id="{{ obj.elementid }}"{% if obj.id %} data-root-id="{{ obj.id }}"{% endif %}></div>
{%- endmacro %}
{% block head %}
<head>
    {% block inner_head %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ title | e if title else "Bokeh Plot" }}{% endblock %}</title>

    {% block preamble %}{% endblock %}

    {% block resources %}
        {% block css_resources %}
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <style>
        html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
        </style>
        <link rel="stylesheet" href="static/css/style.css">

        {{ bokeh_css | indent(8) if bokeh_css }}
        {% endblock %}

        {% block js_resources %}
        {{ bokeh_js | indent(8) if bokeh_js }}
        {% endblock %}
    {% endblock %}
    {% block postamble %}{% endblock %}
    {% endblock %}
</head>
{% endblock %}
{% block body %}

<body>
  <header class="w3-bar w3-green">
    <img src="static/img/logo.png" class="w3-image w3-margin" width="100" height="100">


    <div onclick="switch_lang()" class="w3-right w3-button">{{lang_sw}}</div>
    <div onclick="home()" class="w3-right w3-button">{{home_button_text}}</div>
    <div class="w3-dropdown-click w3-right">
      <button onclick="myFunction('dropdown')" class="w3-button w3-black">
        {{mutation_choice_button_text}}
      </button>
      <div id="dropdown:" class="w3-dropdown-content w3-bar-block w3-border" style="max-height:250px; overflow:auto;"></div>
    </div>
  </header>

  <div class="w3-container w3-center w3-border w3-border-red w3-round-xxlarge w3-center w3-margin w3-grey">
    <p class="welcome_text">
      {{welcome_text}}
    </p>
  </div>

  <div class="w3-row w3-margin w3-padding">
    <p class="w3-strong info_header_text">
      {{mutation_info_header}}
    </p>
    <div class="w3-row w3-green">
      <div class="w3-container w3-padding-24 w3-col l10 m9 s8">
        <div id="dateRangeSlider"></div>
      </div>
      <div onclick="updateDate('{{min_date}}', '{{max_date}}')" class="w3-green w3-button w3-col l2 m3 s4" id="updateDate">
        <p>{{update_button_text}}:</p>
        <p class="w3-strong" id="updateDateText">
          {{min_date}} - {{max_date}}
        </p>
      </div>
    </div>
    <div class="w3-border">
      <div id="coronaplot"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="w3-container w3-padding-64 w3-center w3-opacity">
    <div class="w3-xlarge w3-padding-32">
      <i class="fa fa-facebook-official w3-hover-opacity"></i>
      <i class="fa fa-instagram w3-hover-opacity"></i>
      <i class="fa fa-snapchat w3-hover-opacity"></i>
      <i class="fa fa-pinterest-p w3-hover-opacity"></i>
      <i class="fa fa-twitter w3-hover-opacity"></i>
      <i class="fa fa-linkedin w3-hover-opacity"></i>
   </div>
   <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  </footer>
<script>
  var dropdown = document.getElementById("dropdown:");
  var mutations = {{mutations_names}};
  var url_string = window.location.href;
  var url = new URL(url_string);
  var language = url.searchParams.get("lang");
  var max_date = url.searchParams.get("max_date");
  var min_date = url.searchParams.get("min_date");
  var mutation = mutations[0];
  var mutation_array = mutation.split(':');
  var previous_gene = mutation_array[0];
  var gene_button = document.createElement("div");
  gene_button.className = "w3-bar-item w3-dropdown-click";
  var gene_button_button = document.createElement("button");
  gene_button_button.id = previous_gene;
  gene_button_button.textContent = previous_gene;
  gene_button_button.className = "w3-button";
  gene_button_button.onclick = function() {myFunction(this.id)};
  var gene_button_content = document.createElement("div");
  gene_button_content.id = previous_gene + ":";
  gene_button_content.className = "w3-dropdown-content w3-bar-block w3-border";
  gene_button.appendChild(gene_button_button);
  gene_button.appendChild(gene_button_content);
  dropdown.appendChild(gene_button);
  for (var i = 0; i < mutations.length; i++) {
    var mutation = mutations[i];
    var mutation_array = mutation.split(':');
    var gene = mutation_array[0];
    var mutation_name = mutation_array[1];
    if (gene != previous_gene)
    {
        var previous_gene = gene;
        var gene_button = document.createElement("div");
        gene_button.className = "w3-bar-item w3-dropdown-click";
        var gene_button_button = document.createElement("button");
        gene_button_button.id = gene;
        gene_button_button.textContent = gene;
        gene_button_button.className = "w3-button";
        gene_button_button.onclick = function() {myFunction(this.id)};
        var gene_button_content = document.createElement("div");
        gene_button_content.id = gene + ":";
        gene_button_content.className = "w3-dropdown-content w3-bar-block w3-border";
        gene_button.appendChild(gene_button_button);
        gene_button.appendChild(gene_button_content);
        dropdown.appendChild(gene_button);

    }
    var mutation_button = document.createElement("a");
    mutation_button.textContent = mutation_name;
    mutation_button.className = "w3-bar-item w3-button";
    mutation_button.href = `/?mutation=${mutation}&lang=${language}&min_date=${min_date}&max_date=${max_date}`;
    gene_button_content.appendChild(mutation_button);
  }


  var mutation = url.searchParams.get("mutation");

  fetch(`/plot?mutation=${mutation}&lang=${language}&max_date=${max_date}&min_date=${min_date}`)
      .then(function(response) { return response.json(); })
      .then(function(item) { return Bokeh.embed.embed_item(item, "coronaplot"); })

  fetch(`/dateRangeSlider?mutation=${mutation}&lang=${language}&max_date=${max_date}&min_date=${min_date}`)
      .then(function(response) { return response.json(); })
      .then(function(item) { return Bokeh.embed.embed_item(item, "dateRangeSlider"); })


  function switch_lang() {
    var url_string = window.location.href;
    var url = new URL(url_string);
    var mutation = url.searchParams.get("mutation");
    var language = url.searchParams.get("lang");
    var max_date = url.searchParams.get("max_date");
    var min_date = url.searchParams.get("min_date");
    if (language == "EN")
    {
      language = "RU";
    }
    else
    {
      language = "EN";
    }
    window.location.href=(`/?mutation=${mutation}&lang=${language}&min_date=${min_date}&max_date=${max_date}`);
  }


  function home() {
    var url_string = window.location.href;
    var url = new URL(url_string);
    var language = url.searchParams.get("lang");
    var max_date = url.searchParams.get("max_date");
    var min_date = url.searchParams.get("min_date");
    window.location.href=(`/?mutation=ALL&lang=${language}&min_date=${min_date}&max_date=${max_date}`);
  }


  function myFunction(id) {
  var x = document.getElementById(id + ":");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else {
    x.className = x.className.replace(" w3-show", "");
  }
  }

  function updateDate(min_date, max_date) {
    var mutation = url.searchParams.get("mutation");
    var language = url.searchParams.get("lang");
    window.location.href=(`/?mutation=${mutation}&lang=${language}&min_date=${min_date}&max_date=${max_date}`);
  }


</script>

</body>
{% endblock %}
</html>
